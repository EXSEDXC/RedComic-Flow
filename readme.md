# 小红书自动化全链路控制台 (XHS Automation Console)

本项目是一款专为内容创作者设计的全链路自动化工具。它不仅涵盖了从**笔记采集、AI 视觉过滤、文案深度改写**到**批量自动发布**的闭环，还集成了**后期数据回流分析**功能，帮助用户通过 AI 驱动实现账号的高效运营。

## 📸 核心工作流图解

1. **发现素材**：根据关键词爬取小红书热门笔记。
2. **智能过滤**：利用 Qwen-VL 多模态大模型自动识别“六格漫画”等特定风格素材。
3. **内容重塑**：AI 聚合图片上下文，改写生成连贯、无痕的纯文本故事及标签。
4. **全自动发布**：模拟真人操作，自动上传图片、注入文案并触发话题推荐。
5. **运营反馈**：定时回爬笔记互动数据（阅读、点赞等），生成可视化图表报表。

---

## 🚀 核心模块详细说明

### 1. 可视化控制台 (`main_dashboard.py`)

* **实时交互**：基于 Pygame 开发，支持搜索词、采集上限、发布间隔等参数的实时配置。
* **多线程架构**：GUI 界面与后台任务逻辑分离，确保在执行耗时任务（如采集或发布）时界面依然流畅不卡顿。
* **任务流调度**：一键调用各功能脚本，无需在命令行手动切换程序。

### 2. 智能视觉识别爬虫 (`spider.py`)

* **DrissionPage 驱动**：有效绕过自动化检测，提升采集稳定性。
* **双重过滤机制**：
* **基础过滤**：检查图片分辨率及正文中文字数。
* **AI 深度识别**：集成阿里云百炼 `qwen-vl-plus` 模型，精准判断图片是否符合“六格漫画”排版标准。


* **数据持久化**：采集成功的笔记将保存至 `RedComic_Final_Fixed` 文件夹，并生成详细的 `metadata.csv`。

### 3. AI 故事改写引擎 (`rewrite_images.py`)

* **多图上下文感知**：将一组图片序列编码后发送给 AI，使其能理解连贯的故事情节。
* **纯文本输出控制**：严格限制输出格式，禁绝 Markdown 符号，确保生成的文案可直接用于小红书发布。
* **自动化存档**：生成的文案自动存入 `series_story.csv` 供发布脚本调用。

### 4. 矩阵号自动发布 (`auto_publish_batch.py`)

* **Cookie 持久化**：支持手动扫码登录并自动保存 Cookie，后续发布实现零干扰免登录。
* **风控规避**：集成防检测指纹修正，模拟真人点击话题标签，降低封号风险。
* **动态流控**：根据图片数量动态调整等待时间，支持批量上传。

### 5. 数据回流与分析 (`fetch_interaction_stats.py` & `visualize_stats.py`)

* **数据回爬**：自动访问创作者中心，获取已发布笔记的阅读、点赞、收藏、评论及分享数。
* **可视化报表**：基于 Matplotlib 生成趋势分析图，对比各笔记的表现，辅助运营决策。

### 6. 数据转换工具 (`json转换脚本.py`)

* **格式转换**：支持将采集到的 CSV 数据及关联图片路径转换为标准 JSON 格式，方便进行二次开发或作为模型训练的标注集。

---

## 🛠️ 环境搭建与配置

### 1. 基础环境

* **Python**: 3.9+
* **Chrome 浏览器**: 请确保安装了最新版 Chrome。

### 2. 安装依赖

```bash
pip install -r requirements.txt

```

### 3. API 密钥配置

在项目根目录新建 `.env` 文件：

```env
# 阿里云百炼 API 密钥
DASHSCOPE_API_KEY=sk-your-api-key-here

```

---

## 📖 操作指南 (发布流程必读)

1. **启动控制台**：运行 `python main_dashboard.py`。
2. **采集素材**：
* 设定关键词，开启 “Qwen 视觉过滤”。
* 点击 **“1. 采集 (Spider)”**。


3. **准备发布库**：
* 在根目录手动创建 `images` 文件夹。
* 从 `RedComic_Final_Fixed` 中挑选素材放入 `images`，并按 `1.jpg, 2.jpg...` 顺序命名。


4. **文案生成**：点击 **“2. AI 文案改写”**，生成 `series_story.csv`。
5. **一键发布**：点击 **“3. 批量自动发布”**。初次使用请根据提示扫码登录。
6. **数据复盘**：
* 运行 **“4. 数据采集”** 获取最新互动量。
* 运行 **“5. 统计报表”** 查看可视化分析。



---

## 📂 项目主要目录结构

```text
.
├── main_dashboard.py      # GUI 可视化控制台
├── spider.py              # 智能爬虫模块
├── rewrite_images.py      # AI 文案改写模块
├── auto_publish_batch.py  # 自动发布脚本
├── fetch_interaction_stats.py # 数据回爬脚本
├── visualize_stats.py     # 数据可视化脚本
├── RedComic_Final_Fixed/  # 原始采集素材库
├── images/                # 待发布素材暂存区
├── app_config.json        # 界面配置缓存
└── series_story.csv       # 生成的发布文案库

```



---

## 🛠️ 自定义配置指南 (进阶必读)

你可以通过修改脚本中的关键参数，让程序更贴合你的特定业务场景。

### 1. 修改 AI 过滤逻辑 (`spider.py`)

如果你不想采集“六格漫画”，而是想采集“多图穿搭”或“知识卡片”，可以修改 `prompt` 变量：

```python
# spider.py 第 20 行左右
prompt = """
请判断图片是否为：[在此输入你的判断标准，例如：干净的室内穿搭图]
要求：[1. 背景整洁 2. 全身出镜...]
只回答：是 或 否
"""

```

### 2. 调整采集质量阈值 (`spider.py`)

在 `is_quality_ok` 函数中，你可以调整过滤参数以控制素材质量：

* `min_resolution`: 过滤低清图（默认设置如 800x800）。
* `min_text_len`: 过滤文案过短的笔记（防止采集到纯广告）。

### 3. 定义 AI 改写风格 (`rewrite_images.py`)

修改提示词可以改变文案的“人设”：

* **萌妹风格**：在提示词中加入“多使用 Emoji，语气夸张”。
* **干货风格**：在提示词中加入“采用分点叙述，逻辑清晰”。

---

## ❓ 常见问题排查 (FAQ)

* **浏览器驱动错误**：
* 现象：提示 `SessionNotCreatedException`。
* 解决：更新 Chrome 浏览器，或删除项目中的 `chromedriver` 让程序自动重新下载。


* **登录失败/发布卡死**：
* 现象：程序停在登录页不跳转。
* 解决：删除本地生成的 `cookies.json` 文件，重新运行发布脚本进行扫码登录。


* **API 额度报错**：
* 现象：日志显示 `[API Error]`。
* 解决：前往阿里云百炼后台检查 API Key 是否配置正确，以及 `qwen-vl-plus` 模型是否有余额。


* **图片读取顺序错乱**：
* 解决：程序严格按文件名排序。请务必将图片命名为 `1.jpg`, `2.jpg`, `3.jpg` ...

---

## 🗺️ 未来路线图 (Roadmap)

* [ ] **多账号管理**：支持切换不同的 Cookie 配置文件，实现矩阵号一键切换。
* [ ] **视频自动发布**：扩展对 60s 以内短视频的自动化上传支持。
* [ ] **本地模型接入**：适配 Ollama 本地部署，支持 LLaVA 等开源多模态模型以节省 API 成本。
* [ ] **评论区自动回复**：集成大模型自动识别用户评论并进行高情商回复。

---

## ⚖️ 免责声明 (Disclaimer)

### 1. 合规使用

本程序（以下简称“本工具”）仅供**学术研究**与**个人学习**参考之用。请确保在法律法规、小红书平台服务协议（TOS）以及相关隐私政策允许的范围内使用本工具。严禁将本工具用于任何商业盈利、非法侵入、网络攻击或大规模恶意骚扰行为。

### 2. 账号安全

本工具通过模拟浏览器行为进行操作。由于平台风控策略会不定期更新，使用本工具可能面临**账号封禁、功能受限、流量降权**等风险。开发者不对任何因使用本工具导致的账号损失负责。

### 3. 版权保护

本工具采集的数据及图片版权归原作者及小红书平台所有。用户在使用采集到的素材进行二次创作或发布时，应严格遵守著作权法。因不当使用他人原创内容而引发的侵权争议，由使用者自行承担全部责任。

### 4. 数据安全

本工具不收集、不上传任何用户的 API Key、Cookie、个人账号信息至第三方服务器。所有隐私数据（如 `.env` 文件、`cookies.json`）均保存在本地磁盘，请用户妥善保管。

### 5. 风险自担

使用本工具即表示您已阅读并同意上述声明。开发者不保证工具的绝对稳定性与持续有效性，对因软件缺陷、网络异常或平台机制变更导致的一切直接或间接损失不承担赔偿责任。

